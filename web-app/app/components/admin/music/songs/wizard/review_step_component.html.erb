<%= render(Wizard::StepComponent.new(
  title: "Review",
  description: "Review all items before importing",
  step_number: 5,
  active: true
)) do |step| %>
  <% step.with_step_content do %>
    <div class="space-y-6" data-controller="review-filter">
      <%# Stats Cards %>
      <div class="stats stats-vertical lg:stats-horizontal shadow w-full">
        <div class="stat">
          <div class="stat-title">Total Items</div>
          <div class="stat-value text-primary"><%= total_count %></div>
          <div class="stat-desc">Unverified items</div>
        </div>
        <div class="stat">
          <div class="stat-title">Valid</div>
          <div class="stat-value text-success"><%= valid_count %></div>
          <div class="stat-desc"><%= percentage(valid_count) %>% of total</div>
        </div>
        <div class="stat">
          <div class="stat-title">Invalid</div>
          <div class="stat-value text-error"><%= invalid_count %></div>
          <div class="stat-desc"><%= percentage(invalid_count) %>% of total</div>
        </div>
        <div class="stat">
          <div class="stat-title">Missing</div>
          <div class="stat-value text-base-content/70"><%= missing_count %></div>
          <div class="stat-desc"><%= percentage(missing_count) %>% of total</div>
        </div>
      </div>

      <%# Filter Bar %>
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 bg-base-200 p-4 rounded-lg">
        <div class="flex items-center gap-2">
          <label for="status-filter" class="text-sm font-medium">Filter:</label>
          <select
            id="status-filter"
            class="select select-bordered select-sm w-40"
            data-review-filter-target="filter"
            data-action="change->review-filter#filter">
            <option value="all">Show All</option>
            <option value="valid">Valid Only</option>
            <option value="invalid">Invalid Only</option>
            <option value="missing">Missing Only</option>
          </select>
        </div>
        <span class="text-sm text-base-content/70" data-review-filter-target="count">
          Showing <%= total_count %> items
        </span>
      </div>

      <%# Review Table %>
      <% if items.any? %>
        <div class="overflow-x-auto max-h-[32rem] overflow-y-auto">
          <table class="table table-sm table-pin-rows w-full">
            <thead>
              <tr>
                <th class="w-[60px]">Status</th>
                <th class="w-[50px]">#</th>
                <th>Original</th>
                <th>Matched</th>
                <th class="w-[100px]">Source</th>
                <th class="w-[100px]">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% items.each do |item| %>
                <% status = item_status(item) %>
                <tr
                  class="<%= row_background_class(status) %>"
                  data-review-filter-target="row"
                  data-status="<%= status %>"
                  data-item-id="<%= item.id %>">
                  <td>
                    <span class="<%= status_badge_class(status) %>" title="<%= status.titleize %>">
                      <%= status_badge_icon(status) %>
                    </span>
                  </td>
                  <td><%= item.position %></td>
                  <td>
                    <div class="font-medium"><%= original_title(item) %></div>
                    <div class="text-xs text-base-content/70"><%= original_artists(item) %></div>
                  </td>
                  <td>
                    <% if matched_title(item) %>
                      <div class="font-medium"><%= matched_title(item) %></div>
                      <% if matched_artists(item).present? %>
                        <div class="text-xs text-base-content/70"><%= matched_artists(item) %></div>
                      <% end %>
                    <% else %>
                      <span class="text-base-content/50">-</span>
                    <% end %>
                  </td>
                  <td>
                    <% badge = source_badge(item) %>
                    <span class="<%= badge[:class] %>" title="<%= badge[:title] %>">
                      <%= badge[:text] %>
                    </span>
                  </td>
                  <td>
                    <span class="text-base-content/50 text-sm">-</span>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center text-base-content/70 py-8">
          No items to review
        </div>
      <% end %>
    </div>
  <% end %>
<% end %>
