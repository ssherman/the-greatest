<%= render(Wizard::StepComponent.new(
  title: "Review",
  description: "Review all items before importing",
  step_number: 5,
  active: true
)) do |step| %>
  <% step.with_step_content do %>
    <div class="space-y-6"
         data-controller="review-filter"
         data-review-filter-total-count-value="<%= total_count %>"
         data-review-filter-valid-count-value="<%= valid_count %>"
         data-review-filter-invalid-count-value="<%= invalid_count %>"
         data-review-filter-missing-count-value="<%= missing_count %>">
      <%# Stats Cards - ID for Turbo Stream updates when rows change status %>
      <div id="review_stats_<%= list.id %>" class="stats stats-vertical lg:stats-horizontal shadow w-full">
        <div class="stat">
          <div class="stat-title">Total Items</div>
          <div class="stat-value text-primary"><%= total_count %></div>
          <div class="stat-desc">Unverified items</div>
        </div>
        <div class="stat">
          <div class="stat-title">Valid</div>
          <div class="stat-value text-success"><%= valid_count %></div>
          <div class="stat-desc"><%= percentage(valid_count) %>% of total</div>
        </div>
        <div class="stat">
          <div class="stat-title">Invalid</div>
          <div class="stat-value text-error"><%= invalid_count %></div>
          <div class="stat-desc"><%= percentage(invalid_count) %>% of total</div>
        </div>
        <div class="stat">
          <div class="stat-title">Missing</div>
          <div class="stat-value text-base-content/70"><%= missing_count %></div>
          <div class="stat-desc"><%= percentage(missing_count) %>% of total</div>
        </div>
      </div>

      <%# Filter Bar %>
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 bg-base-200 p-4 rounded-lg">
        <div class="flex items-center gap-2">
          <label for="status-filter" class="text-sm font-medium">Filter:</label>
          <select
            id="status-filter"
            class="select select-bordered select-sm w-40"
            data-review-filter-target="filter"
            data-action="change->review-filter#filter">
            <option value="all">Show All</option>
            <option value="valid">Valid Only</option>
            <option value="invalid">Invalid Only</option>
            <option value="missing">Missing Only</option>
          </select>
        </div>
        <span class="text-sm text-base-content/70" data-review-filter-target="count">
          Showing <%= total_count %> items
        </span>
      </div>

      <%# Review Table - Uses CSS-based filtering for performance with 1000+ items %>
      <% if items.any? %>
        <div class="overflow-x-auto max-h-[32rem] min-h-[16rem] overflow-y-auto"
             data-review-filter-target="container"
             data-filter="all">
          <%# CSS filtering rules - hide rows that don't match the current filter %>
          <style>
            [data-filter="valid"] tr[data-status]:not([data-status="valid"]),
            [data-filter="invalid"] tr[data-status]:not([data-status="invalid"]),
            [data-filter="missing"] tr[data-status]:not([data-status="missing"]) {
              display: none;
            }
          </style>
          <table class="table table-sm table-pin-rows w-full">
            <thead>
              <tr>
                <th class="w-[60px]">Status</th>
                <th class="w-[50px]">#</th>
                <th>Original</th>
                <th>Matched</th>
                <th class="w-[100px]">Source</th>
                <th class="w-[100px]">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% items.each do |item| %>
                <%= render(Admin::Music::Songs::Wizard::ItemRowComponent.new(item: item)) %>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center text-base-content/70 py-8">
          No items to review
        </div>
      <% end %>

      <%# Shared modal - single dialog for all modal types, content loads on-demand %>
      <%= render(Admin::Music::Songs::Wizard::SharedModalComponent.new) %>
    </div>
  <% end %>
<% end %>
