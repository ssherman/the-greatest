<%= form_with model: list, url: form_url, class: "space-y-6" do |f| %>
  <% if list.errors.any? %>
    <div class="alert alert-error">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div>
        <h3 class="font-bold"><%= pluralize(list.errors.count, "error") %> prohibited this <%= error_noun %> from being saved:</h3>
        <ul class="list-disc list-inside mt-2">
          <% list.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Basic Information</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-control md:col-span-2">
          <%= f.label :name, class: "label" do %>
            <span class="label-text font-semibold">Name <span class="text-error">*</span></span>
          <% end %>
          <%= f.text_field :name,
              class: "input input-bordered w-full #{list.errors[:name].any? ? 'input-error' : ''}",
              placeholder: "Enter list name",
              required: true,
              autofocus: true %>
          <% if list.errors[:name].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:name].first %></span>
            </label>
          <% end %>
        </div>

        <div class="form-control md:col-span-2">
          <%= f.label :description, class: "label" do %>
            <span class="label-text font-semibold">Description</span>
          <% end %>
          <%= f.text_area :description,
              class: "textarea textarea-bordered w-full h-32 #{list.errors[:description].any? ? 'textarea-error' : ''}",
              placeholder: "Enter a description of the list..." %>
          <label class="label">
            <span class="label-text-alt">Background information about this list</span>
          </label>
          <% if list.errors[:description].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:description].first %></span>
            </label>
          <% end %>
        </div>

        <div class="form-control md:col-span-2">
          <%= f.label :status, class: "label" do %>
            <span class="label-text font-semibold">Status <span class="text-error">*</span></span>
          <% end %>
          <%= f.select :status,
              options_for_select(
                List.statuses.map { |k, v| [k.titleize, k] },
                list.status
              ),
              {},
              class: "select select-bordered w-full #{list.errors[:status].any? ? 'select-error' : ''}",
              required: true %>
          <% if list.errors[:status].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:status].first %></span>
            </label>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Source Information</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-control">
          <%= f.label :source, class: "label" do %>
            <span class="label-text font-semibold">Source</span>
          <% end %>
          <%= f.text_field :source,
              class: "input input-bordered w-full #{list.errors[:source].any? ? 'input-error' : ''}",
              placeholder: domain_config[:source_placeholder] %>
          <label class="label">
            <span class="label-text-alt">Publication or organization that created this list</span>
          </label>
          <% if list.errors[:source].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:source].first %></span>
            </label>
          <% end %>
        </div>

        <div class="form-control">
          <%= f.label :source_country_origin, class: "label" do %>
            <span class="label-text font-semibold">Source Country Origin</span>
          <% end %>
          <%= f.text_field :source_country_origin,
              class: "input input-bordered w-full #{list.errors[:source_country_origin].any? ? 'input-error' : ''}",
              placeholder: domain_config[:country_placeholder] %>
          <label class="label">
            <span class="label-text-alt">Country where the source publication is based</span>
          </label>
          <% if list.errors[:source_country_origin].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:source_country_origin].first %></span>
            </label>
          <% end %>
        </div>

        <div class="form-control">
          <%= f.label :url, class: "label" do %>
            <span class="label-text font-semibold">URL</span>
          <% end %>
          <%= f.url_field :url,
              class: "input input-bordered w-full #{list.errors[:url].any? ? 'input-error' : ''}",
              placeholder: "https://example.com/list" %>
          <label class="label">
            <span class="label-text-alt">Link to the original list</span>
          </label>
          <% if list.errors[:url].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:url].first %></span>
            </label>
          <% end %>
        </div>

        <div class="form-control">
          <%= f.label :year_published, class: "label" do %>
            <span class="label-text font-semibold">Year Published</span>
          <% end %>
          <%= f.number_field :year_published,
              class: "input input-bordered w-full #{list.errors[:year_published].any? ? 'input-error' : ''}",
              placeholder: "2024",
              min: 1900,
              max: Date.current.year + 1 %>
          <% if list.errors[:year_published].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:year_published].first %></span>
            </label>
          <% end %>
        </div>

        <% if show_musicbrainz_field? %>
          <div class="form-control">
            <%= f.label :musicbrainz_series_id, class: "label" do %>
              <span class="label-text font-semibold">MusicBrainz Series ID</span>
            <% end %>
            <%= f.text_field :musicbrainz_series_id,
                class: "input input-bordered w-full font-mono #{list.errors[:musicbrainz_series_id].any? ? 'input-error' : ''}",
                placeholder: "e.g., 12345678-1234-1234-1234-123456789012" %>
            <label class="label">
              <span class="label-text-alt">MusicBrainz series identifier</span>
            </label>
            <% if list.errors[:musicbrainz_series_id].any? %>
              <label class="label">
                <span class="label-text-alt text-error"><%= list.errors[:musicbrainz_series_id].first %></span>
              </label>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Quality Metrics</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="form-control">
          <%= f.label :number_of_voters, class: "label" do %>
            <span class="label-text font-semibold">Number of Voters</span>
          <% end %>
          <%= f.number_field :number_of_voters,
              class: "input input-bordered w-full #{list.errors[:number_of_voters].any? ? 'input-error' : ''}",
              placeholder: "0",
              min: 0 %>
          <% if list.errors[:number_of_voters].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:number_of_voters].first %></span>
            </label>
          <% end %>
        </div>

        <div class="form-control">
          <%= f.label :estimated_quality, class: "label" do %>
            <span class="label-text font-semibold">Estimated Quality</span>
          <% end %>
          <%= f.number_field :estimated_quality,
              class: "input input-bordered w-full #{list.errors[:estimated_quality].any? ? 'input-error' : ''}",
              placeholder: "0" %>
          <label class="label">
            <span class="label-text-alt">Quality score (0-100)</span>
          </label>
          <% if list.errors[:estimated_quality].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:estimated_quality].first %></span>
            </label>
          <% end %>
        </div>

        <div class="form-control">
          <%= f.label :num_years_covered, class: "label" do %>
            <span class="label-text font-semibold">Years Covered</span>
          <% end %>
          <%= f.number_field :num_years_covered,
              class: "input input-bordered w-full #{list.errors[:num_years_covered].any? ? 'input-error' : ''}",
              placeholder: "1",
              min: 1 %>
          <label class="label">
            <span class="label-text-alt">Number of years this list covers</span>
          </label>
          <% if list.errors[:num_years_covered].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:num_years_covered].first %></span>
            </label>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Flags</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-4">
            <%= f.check_box :high_quality_source, class: "checkbox" %>
            <span class="label-text">High Quality Source</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-4">
            <%= f.check_box :category_specific, class: "checkbox" %>
            <span class="label-text">Category Specific</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-4">
            <%= f.check_box :location_specific, class: "checkbox" %>
            <span class="label-text">Location Specific</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-4">
            <%= f.check_box :yearly_award, class: "checkbox" %>
            <span class="label-text">Yearly Award</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-4">
            <%= f.check_box :voter_count_estimated, class: "checkbox" %>
            <span class="label-text">Voter Count Estimated</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-4">
            <%= f.check_box :voter_count_unknown, class: "checkbox" %>
            <span class="label-text">Voter Count Unknown</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-4">
            <%= f.check_box :voter_names_unknown, class: "checkbox" %>
            <span class="label-text">Voter Names Unknown</span>
          </label>
        </div>

        <div class="form-control">
          <label class="label cursor-pointer justify-start gap-4">
            <%= f.check_box :creator_specific, class: "checkbox" %>
            <span class="label-text">Creator Specific</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <h2 class="card-title">Data Import</h2>
      <p class="text-sm text-base-content/70 mb-4">
        These fields are typically populated by scraping/import processes. Edit with care.
      </p>

      <div class="space-y-4">
        <div class="form-control">
          <%= f.label :raw_content, class: "label" do %>
            <span class="label-text font-semibold">Raw Content</span>
          <% end %>
          <%= f.text_area :raw_content,
              class: "textarea textarea-bordered w-full font-mono text-xs h-48 #{list.errors[:raw_content].any? ? 'textarea-error' : ''}",
              placeholder: "Paste HTML or plain text from the source list..." %>
          <label class="label">
            <span class="label-text-alt">Paste the original content from the list source â€” HTML or plain text. On save, this is automatically sanitized and used to populate Simplified Content below.</span>
          </label>
          <% if list.errors[:raw_content].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:raw_content].first %></span>
            </label>
          <% end %>
        </div>

        <div class="form-control">
          <%= f.label :simplified_content, class: "label" do %>
            <span class="label-text font-semibold">Simplified Content</span>
          <% end %>
          <%= f.text_area :simplified_content,
              class: "textarea textarea-bordered w-full font-mono text-xs h-48 #{list.errors[:simplified_content].any? ? 'textarea-error' : ''}",
              placeholder: "Auto-generated from Raw Content on save..." %>
          <label class="label">
            <span class="label-text-alt">Auto-generated by sanitizing Raw Content (scripts, styles, images, and non-essential markup are stripped). You can manually edit this to clean up or correct the result. This is what gets sent to AI for parsing into list items.</span>
          </label>
          <% if list.errors[:simplified_content].any? %>
            <label class="label">
              <span class="label-text-alt text-error"><%= list.errors[:simplified_content].first %></span>
            </label>
          <% end %>
        </div>

        <% if list.items_json.present? %>
          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Items JSON</span>
              <span class="label-text-alt"><%= pluralize(count_items_json(list.items_json), "item") %></span>
            </label>
            <div class="bg-base-200 p-4 rounded-lg overflow-x-auto max-h-48">
              <pre class="text-xs"><%= items_json_to_string(list.items_json) %></pre>
            </div>
            <label class="label">
              <span class="label-text-alt">Auto-generated by AI parsing. Read-only.</span>
            </label>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="alert alert-info">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
    <span><%= domain_config[:info_alert_text] %></span>
  </div>

  <div class="flex flex-col sm:flex-row gap-2 justify-end">
    <%= link_to "Cancel", cancel_path, class: "btn btn-ghost" %>
    <%= f.submit submit_label, class: "btn btn-primary" %>
  </div>
<% end %>
