<%= turbo_frame_tag "artist_albums_list" do %>
  <% if artist.album_artists.any? %>
    <div class="overflow-x-auto">
      <table class="table table-zebra">
        <thead>
          <tr>
            <th>Position</th>
            <th>Album</th>
            <th>Release Year</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% artist.album_artists.ordered.includes(:album).each do |album_artist| %>
          <tr>
            <td>
              <span class="badge badge-sm"><%= album_artist.position %></span>
            </td>
            <td>
              <%= link_to album_artist.album.title,
                  admin_album_path(album_artist.album),
                  class: "link link-hover",
                  data: { turbo_frame: "_top" } %>
            </td>
            <td>
              <%= album_artist.album.release_year || "-" %>
            </td>
            <td>
              <div class="flex gap-2">
                <button class="btn btn-ghost btn-sm"
                        onclick="edit_album_artist_<%= album_artist.id %>_modal.showModal()">
                  Edit
                </button>
                <%= button_to "Remove",
                    admin_album_artist_path(album_artist),
                    method: :delete,
                    class: "btn btn-ghost btn-sm text-error",
                    data: {
                      turbo_confirm: "Remove #{album_artist.album.title} from this artist?"
                    } %>
              </div>
            </td>
          </tr>

          <dialog id="edit_album_artist_<%= album_artist.id %>_modal" class="modal">
            <div class="modal-box max-w-2xl">
              <h3 class="font-bold text-lg">Edit Album Position</h3>
              <p class="py-4 text-sm text-gray-500">
                Update the position for this album on the artist.
              </p>

              <%= form_with model: album_artist,
                            url: admin_album_artist_path(album_artist),
                            method: :patch,
                            class: "space-y-4",
                            data: {
                              controller: "modal-form",
                              modal_form_modal_id_value: "edit_album_artist_#{album_artist.id}_modal",
                              turbo_frame: "artist_albums_list"
                            } do |f| %>

                <div class="form-control">
                  <%= f.label :artist_id, "Artist", class: "label" do %>
                    <span class="label-text font-semibold">Artist</span>
                  <% end %>
                  <%= f.text_field :artist_id,
                      value: artist.name,
                      disabled: true,
                      class: "input input-bordered input-disabled w-full" %>
                </div>

                <div class="form-control">
                  <%= f.label :album_id, "Album", class: "label" do %>
                    <span class="label-text font-semibold">Album</span>
                  <% end %>
                  <%= f.text_field :album_id,
                      value: album_artist.album.title,
                      disabled: true,
                      class: "input input-bordered input-disabled w-full" %>
                </div>

                <div class="form-control">
                  <%= f.label :position, class: "label" do %>
                    <span class="label-text font-semibold">Position <span class="text-error">*</span></span>
                  <% end %>
                  <%= f.number_field :position,
                      value: album_artist.position,
                      min: 1,
                      class: "input input-bordered w-full",
                      required: true %>
                  <label class="label">
                    <span class="label-text-alt">Position in album ordering (1 = first album)</span>
                  </label>
                </div>

                <div class="modal-action">
                  <button type="button"
                          class="btn"
                          onclick="edit_album_artist_<%= album_artist.id %>_modal.close()">
                    Cancel
                  </button>
                  <%= f.submit "Update Position", class: "btn btn-primary" %>
                </div>
              <% end %>
            </div>
            <form method="dialog" class="modal-backdrop">
              <button>close</button>
            </form>
          </dialog>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <p class="text-gray-500 text-sm">No albums associated with this artist yet.</p>
  <% end %>
<% end %>
