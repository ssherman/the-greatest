<% content_for :title, "Games" %>

<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-3xl font-bold">Games</h1>
      <p class="text-sm text-base-content/70 mt-1">Manage video games catalog</p>
    </div>
    <div class="flex gap-2">
      <% if policy(Games::Game).import? %>
        <button type="button"
                class="btn btn-outline"
                onclick="document.getElementById('import-igdb-modal').showModal()">
          Import from IGDB
        </button>
      <% end %>
      <%= link_to new_admin_games_game_path, class: "btn btn-primary" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
        <span>New Game</span>
      <% end %>
    </div>
  </div>

  <!-- Search -->
  <div class="card bg-base-100 shadow-sm">
    <div class="card-body">
      <%= render Admin::SearchComponent.new(
        url: admin_games_games_path,
        placeholder: "Search games by title or developer...",
        value: params[:q],
        turbo_frame: "games_table"
      ) %>
    </div>
  </div>

  <!-- Games Table -->
  <div class="card bg-base-100 shadow-xl">
    <div class="card-body p-0">
      <%= turbo_frame_tag "games_table" do %>
        <%= render "table", games: @games, pagy: @pagy %>
      <% end %>
    </div>
  </div>
</div>

<% if policy(Games::Game).import? %>
<!-- Import from IGDB Modal -->
<dialog id="import-igdb-modal" class="modal">
  <div class="modal-box max-w-2xl">
    <h3 class="font-bold text-lg">Import Game from IGDB</h3>
    <p class="py-4 text-sm text-base-content/70">
      Import a game from IGDB by pasting a URL/ID or searching by name.
    </p>

    <%= form_with url: import_from_igdb_admin_games_games_path,
                  method: :post,
                  class: "space-y-4",
                  data: {
                    controller: "modal-form",
                    modal_form_modal_id_value: "import-igdb-modal"
                  } do |f| %>

      <div class="form-control">
        <label class="label">
          <span class="label-text font-semibold">IGDB URL or ID</span>
        </label>
        <input type="text" name="igdb_url"
               class="input input-bordered w-full"
               placeholder="e.g., https://www.igdb.com/games/flight-simulator or 12515" />
        <label class="label">
          <span class="label-text-alt">Paste an IGDB game URL or numeric ID</span>
        </label>
      </div>

      <div class="divider text-sm text-base-content/50">OR</div>

      <div class="form-control">
        <label class="label">
          <span class="label-text font-semibold">Search by name</span>
        </label>
        <%= render AutocompleteComponent.new(
          name: "igdb_id",
          url: igdb_search_admin_games_games_path,
          placeholder: "Search IGDB for game...",
          display_key: "text",
          value_key: "value",
          min_length: 2,
          debounce: 300
        ) %>
        <label class="label">
          <span class="label-text-alt">Start typing to search the IGDB database</span>
        </label>
      </div>

      <div class="modal-action">
        <button type="button" class="btn" onclick="document.getElementById('import-igdb-modal').close()">Cancel</button>
        <%= f.submit "Import", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
<% end %>
